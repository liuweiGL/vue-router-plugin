import{defineComponent as e,getCurrentInstance as t,setTransitionHooks as n,queuePostFlushCb as o,callWithAsyncErrorHandling as r}from"vue";const s=e=>null==e,a=e=>s(e)||""===e,i={keyName:"page_key",componentName:"StackRouterView"};let c;const u=e=>{c=Object.assign(Object.assign({},i),((e,...t)=>{const n={};if(!e||!t)return n;for(const o of t)s(e[o])||(n[o]=e[o]);return n})(e,"keyName","componentName"))},p=()=>c;var l;!function(e){e.PUSH="push",e.GO="go",e.REPLACE="replace",e.BACK="back",e.FORWARD="forward"}(l||(l={}));const m={value:l.PUSH},d=e=>{m.value=e},h=()=>m;let f;const v=()=>f;class g{constructor(e){var t;this.items=null!==(t=null==e?void 0:e.items)&&void 0!==t?t:[]}push(e){return this.items.push(e)}pop(){return this.items.pop()}removeAfter(e){const t=this.items.findIndex((t=>t.key===e));if(-1===t)return;const n=t+1;return n>=this.items.length?void 0:this.items.splice(n,this.items.length-t-1)}clear(){const e=this.items;return this.items=[],e}find(e){var t;return null===(t=this.items.find((t=>t.key===e)))||void 0===t?void 0:t.vnode}value(){return this.items}}const y=(()=>{const e=new g;return()=>e})();function b(e){let t=e.shapeFlag;256&t&&(t-=256),512&t&&(t-=512),e.shapeFlag=t}function A(e,t){t&&t.pendingBranch?Array.isArray(e)?t.effects.push(...e):t.effects.push(e):o(e)}function k(e,t,n,o=null){r(e,t,7,[n,o])}function E(e,t){for(let n=0;n<e.length;n++)e[n](t)}const R=e({inheritRef:!0,__isKeepAlive:!0,props:{component:{type:Object,default:void 0},route:{type:Object,required:!0}},setup(e){const o=y(),r=h(),{keyName:s}=p(),a=t(),i=a.ctx,c=a.suspense,{renderer:{p:u,m:m,um:d,o:{createElement:f}}}=i,v=f("div");function g(e){if(e)for(;e.length;){const t=e.pop();t&&(b(t.vnode),d(t.vnode,a,c))}}return i.activate=(e,t,n,o,r)=>{const s=e.component;m(e,t,n,0,c),u(s.vnode,e,t,n,s,c,o,e.slotScopeIds,r),A((()=>{s.isDeactivated=!1,s.a&&E(s.a);const t=e.props&&e.props.onVnodeMounted;t&&k(t,s.parent,e)}),c)},i.deactivate=e=>{const t=e.component;m(e,v,null,1,c),A((()=>{t.da&&E(t.da);const n=e.props&&e.props.onVnodeUnmounted;n&&k(n,t.parent,e),t.isDeactivated=!0}),c)},()=>{const{component:t,route:a}=e,i=a.query[s],c=o.find(i),u=t;return u?c?(g(o.removeAfter(i)),c.transition&&n(c,c.transition),c.shapeFlag|=512,c):(r.value===l.REPLACE&&g(o.clear()),o.push({key:i,vnode:u}),u.shapeFlag|=256,u):u}}}),O=()=>{const{keyName:e}=p(),{router:t}=v(),n=h();t.beforeEach(((t,o)=>{if(a(t.query[e])){t.query[e]=((e=6)=>Math.random().toString(16).substring(2,e+2))();const r=n.value===l.REPLACE||a(o.query[e]);return{hash:t.hash,path:t.path,name:t.name,params:t.params,query:t.query,meta:t.meta,replace:r}}return!0}))},P={install(e,t){const{router:n}=t;if(!n)throw Error("\n vue-router is necessary. \n\n");u(t),f={app:e,router:n},(()=>{const{app:e,router:t}=v(),n=t.push.bind(t),o=t.go.bind(t),r=t.replace.bind(t),s=t.back.bind(t),a=t.forward.bind(t);e.config.globalProperties.$router||e.use(t),t.push=e=>(d(l.PUSH),n(e)),t.go=e=>{d(l.GO),o(e)},t.replace=e=>(d(l.REPLACE),r(e)),t.back=()=>{d(l.BACK),s()},t.forward=()=>{d(l.FORWARD),a()}})(),(()=>{const{componentName:e}=p(),{app:t}=v();t.component(e,R)})(),O()}};export default P;export{h as useAction,y as useStack};
//# sourceMappingURL=vue-router-plugin.esm.js.map
